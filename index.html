<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Inventory Manager</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Manage your second-hand mobile phone inventory offline">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mobile Inventory">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzI1NjNlYiIgcng9IjQiLz48cGF0aCBkPSJNNyA0aDEwYTIgMiAwIDAgMSAyIDJ2MTJhMiAyIDAgMCAxLTIgMkg3YTIgMiAwIDAgMS0yLTJWNmEyIDIgMCAwIDEgMi0yeiIgZmlsbD0iI2ZmZmZmZiIvPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTciIHI9IjEiIGZpbGw9IiMyNTYzZWIiLz48L3N2Zz4=">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- XLSX.js library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDnndrkMcViNw78xjFUZiMZC99fLA25N-4",
            authDomain: "my-inventory-app-f48a2.firebaseapp.com",
            projectId: "my-inventory-app-f48a2",
            storageBucket: "my-inventory-app-f48a2.firebasestorage.app",
            messagingSenderId: "180271056079",
            appId: "1:180271056079:web:4e0d0b025771dbf174e3ba"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebaseDB = db;
        window.firebaseUtils = {
            collection,
            addDoc,
            getDocs,
            deleteDoc,
            doc,
            updateDoc,
            query,
            orderBy
        };
    </script>
    <style>
        /* Custom styles for better mobile experience */
        .image-preview {
            max-height: 200px;
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-lg">
        <!-- Header -->
        <div class="bg-blue-600 text-white p-6 rounded-lg mb-6 text-center">
            <h1 class="text-2xl font-bold">üì± Mobile Inventory Manager</h1>
            <p class="text-blue-100 mt-2">Manage your second-hand mobile inventory</p>
        </div>

        <!-- Navigation Bar -->
        <div class="bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <div class="flex">
                <button id="navAddMobile" class="flex-1 py-4 px-6 bg-blue-600 text-white font-semibold text-center transition-colors hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    ‚ûï Add Mobile
                </button>
                <button id="navSearchInventory" class="flex-1 py-4 px-6 bg-gray-200 text-gray-700 font-semibold text-center transition-colors hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    üîç Search Inventory
                </button>
            </div>
        </div>

        <!-- Page 1: Add Mobile Form -->
        <section id="addMobilePage" class="page-section">
            <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Add New Mobile</h2>
            
            <form id="mobileForm" class="space-y-4">
                <!-- Brand -->
                <div>
                    <label for="brand" class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                    <input type="text" id="brand" name="brand" required
                           class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <!-- Model -->
                <div>
                    <label for="model" class="block text-sm font-medium text-gray-700 mb-2">Model</label>
                    <input type="text" id="model" name="model" required
                           class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <!-- IMEI -->
                <div>
                    <label for="imei" class="block text-sm font-medium text-gray-700 mb-2">IMEI (15 digits)</label>
                    <input type="text" id="imei" name="imei" required maxlength="15" pattern="[0-9]{15}"
                           class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="123456789012345">
                    <p class="text-xs text-gray-500 mt-1">IMEI must be exactly 15 digits</p>
                </div>

                <!-- Tag ID Display (Read-only during edit) -->
                <div id="tagIdDisplay" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tag ID (Auto-generated)</label>
                    <div class="w-full p-3 bg-gray-100 border border-gray-300 rounded-lg text-lg text-gray-700">
                        <span id="tagIdValue">------</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Tag ID is automatically generated and cannot be changed</p>
                </div>

                <!-- RAM -->
                <div>
                    <label for="ram" class="block text-sm font-medium text-gray-700 mb-2">RAM</label>
                    <select id="ram" name="ram" required
                            class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select RAM</option>
                        <option value="2GB">2GB</option>
                        <option value="3GB">3GB</option>
                        <option value="4GB">4GB</option>
                        <option value="6GB">6GB</option>
                        <option value="8GB">8GB</option>
                        <option value="12GB">12GB</option>
                        <option value="16GB">16GB</option>
                    </select>
                </div>

                <!-- Storage -->
                <div>
                    <label for="storage" class="block text-sm font-medium text-gray-700 mb-2">Storage</label>
                    <select id="storage" name="storage" required
                            class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Storage</option>
                        <option value="16GB">16GB</option>
                        <option value="32GB">32GB</option>
                        <option value="64GB">64GB</option>
                        <option value="128GB">128GB</option>
                        <option value="256GB">256GB</option>
                        <option value="512GB">512GB</option>
                        <option value="1TB">1TB</option>
                    </select>
                </div>

                <!-- Price -->
                <div>
                    <label for="price" class="block text-sm font-medium text-gray-700 mb-2">Price (RS)</label>
                    <input type="number" id="price" name="price" required min="0" step="0.01"
                           class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="299.99">
                    <p class="text-xs text-gray-500 mt-1">Enter the selling price</p>
                </div>

                <!-- Photo Upload -->
                <div>
                    <label for="photo" class="block text-sm font-medium text-gray-700 mb-2">Photo</label>
                    <input type="file" id="photo" name="photo" accept="image/*" capture="environment"
                           class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Take a photo or select from gallery</p>
                </div>

                <!-- Image Preview -->
                <div id="imagePreview" class="hidden">
                    <img id="previewImg" src="" alt="Preview" class="w-full rounded-lg image-preview border-2 border-gray-200">
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg"></div>

                <!-- Submit Button -->
                <button type="submit" id="submitBtn"
                        class="w-full bg-blue-600 text-white p-4 rounded-lg text-lg font-semibold hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    üì± Add to Inventory
                </button>
                
                <!-- Cancel Edit Button (hidden by default) -->
                <button type="button" id="cancelEditBtn" 
                        class="hidden w-full bg-gray-500 text-white p-3 rounded-lg text-lg font-semibold hover:bg-gray-600 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors mt-2">
                    ‚ùå Cancel Edit
                </button>
            </form>
            </div>
        </section>

        <!-- Page 2: Search Inventory -->
        <section id="searchInventoryPage" class="page-section hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">üì¶ Inventory</h2>
                <span id="inventoryCount" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">0 items</span>
            </div>
            
            <!-- Search Bar -->
            <div class="mb-6">
                <input type="text" id="searchInput" placeholder="Search by brand, model, IMEI, or Tag ID..."
                       class="w-full p-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            
            <!-- Action Buttons -->
            <div class="mb-6 space-y-3">
                <button id="exportExcelBtn" 
                        class="w-full bg-green-600 text-white p-3 rounded-lg text-lg font-semibold hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors">
                    üìä Download Inventory
                </button>
                <button id="exportBtn" 
                        class="w-full bg-blue-600 text-white p-3 rounded-lg text-lg font-semibold hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    üì§ Download Inventory Backup (JSON)
                </button>
                <button id="generateTestDataBtn" 
                        class="w-full bg-purple-600 text-white p-3 rounded-lg text-lg font-semibold hover:bg-purple-700 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors">
                    üé≤ Generate Test Data
                </button>
            </div>
            
            <!-- Inventory List -->
            <div id="inventoryList" class="space-y-4">
                <!-- Mobile cards will be inserted here -->
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="text-center py-8 text-gray-500">
                <div class="text-4xl mb-4">‚è≥</div>
                <p class="text-lg">Loading inventory...</p>
                <p class="text-sm">Connecting to database</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-8 text-gray-500">
                <div class="text-6xl mb-4">üì±</div>
                <p class="text-lg">No mobiles in inventory yet</p>
                <p class="text-sm">Add your first mobile above!</p>
            </div>
            </div>
        </section>
    </div>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Check for PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show custom install button/banner
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // Create install button
            const installBtn = document.createElement('div');
            installBtn.id = 'installPrompt';
            installBtn.className = 'fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-3 rounded-lg shadow-lg z-50 flex items-center justify-between';
            installBtn.innerHTML = `
                <div>
                    <strong>üì± Install App</strong><br>
                    <small>Add to your home screen for better experience</small>
                </div>
                <div>
                    <button id="installBtn" class="bg-white text-blue-600 px-3 py-1 rounded text-sm font-semibold mr-2">Install</button>
                    <button id="dismissBtn" class="text-blue-200 px-2 py-1 text-sm">‚úï</button>
                </div>
            `;
            document.body.appendChild(installBtn);

            // Handle install button click
            document.getElementById('installBtn').addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                        document.getElementById('installPrompt').remove();
                    });
                }
            });

            // Handle dismiss button click
            document.getElementById('dismissBtn').addEventListener('click', () => {
                document.getElementById('installPrompt').remove();
            });
        }

        // Handle successful app installation
        window.addEventListener('appinstalled', (evt) => {
            console.log('App was installed successfully');
        });
    </script>
</body>
</html> 